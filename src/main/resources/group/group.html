<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê·¸ë£¹ ê´€ë¦¬ - ì‹¤ì‹œê°„ ë™ê¸°í™”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50">

<div class="container mx-auto p-6">

    <!-- í—¤ë” -->
    <div class="flex justify-between items-center mb-6">
        <input type="text" placeholder="ê·¸ë£¹ ê²€ìƒ‰" class="border-none bg-gray-100 text-gray-700 rounded-lg px-4 py-2 w-1/3 focus:ring-2 focus:ring-blue-400 shadow-sm transition duration-300 text-sm" />
        <button class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 active:scale-95 transition-all duration-200 text-sm" id="addGroupBtn">
            + ê·¸ë£¹ ì¶”ê°€
        </button>
    </div>

    <!-- í…Œì´ë¸” -->
    <table class="table-auto w-full text-left text-gray-700" id="group-table">
        <thead>
        <tr class="bg-blue-50">
            <th class="px-6 py-3 text-xs font-semibold">Group Name</th>
            <th class="px-6 py-3 text-xs font-semibold">Read ê¶Œí•œ</th>
            <th class="px-6 py-3 text-xs font-semibold">Write ê¶Œí•œ</th>
            <th class="px-6 py-3 text-xs font-semibold">ìˆ˜ì •</th>
            <th class="px-6 py-3 text-xs font-semibold">ì‚­ì œ</th>
        </tr>
        </thead>
        <tbody>
        <!-- í…Œì´ë¸” ë‚´ìš©ì´ ì—¬ê¸°ì„œ ë™ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¨ -->
        </tbody>
    </table>

</div>

<script>
    const BASEURL = "http://localhost:8080"
    // SSEë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ì„œë²„ë¡œë¶€í„° ë°›ê¸°
    const eventSource = new EventSource(`${BASEURL}/api/sse/groups`);  // Spring WebFlux SSE ì—”ë“œí¬ì¸íŠ¸

    eventSource.onmessage = function(event) {
        try {
            const groupData = JSON.parse(event.data);  // ì„œë²„ì—ì„œ ë³´ë‚¸ JSON ë°ì´í„°ë¥¼ íŒŒì‹±

            // í…Œì´ë¸”ì— ìƒˆ ê·¸ë£¹ ì¶”ê°€
            const tableBody = document.querySelector("#group-table tbody");

            // ìƒˆë¡œ ë“¤ì–´ì˜¨ ë°ì´í„°ë§Œ ì¶”ê°€ (ê¸°ì¡´ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì§€ ì•ŠìŒ)
            const row = document.createElement('tr');
            row.classList.add('group', 'hover:bg-gray-100', 'transition-all', 'duration-150');

            row.innerHTML = `
            <td class="px-6 py-4 text-sm">${groupData.groupName}</td>
            <td class="px-6 py-4 text-center">
                <div class="flex justify-center items-center space-x-3">
                    <label class="inline-flex items-center text-sm">
                        <input type="radio" name="read_permission_${groupData.groupId}" class="form-radio text-blue-500" ${groupData.readPermission ? 'checked' : ''} />
                        <span class="ml-2">í—ˆìš©</span>
                    </label>
                    <label class="inline-flex items-center text-sm">
                        <input type="radio" name="read_permission_${groupData.groupId}" class="form-radio text-gray-500" ${!groupData.readPermission ? 'checked' : ''} />
                        <span class="ml-2">ê±°ë¶€</span>
                    </label>
                </div>
            </td>
            <td class="px-6 py-4 text-center">
                <div class="relative inline-block w-10 h-5">
                    <input type="checkbox" class="peer hidden" ${groupData.isWrite ? 'checked' : ''} />
                    <span class="absolute inset-0 bg-gray-300 rounded-full transition-all duration-300 peer-checked:bg-blue-500"></span>
                    <span class="absolute top-0.5 left-1 w-4 h-4 bg-white rounded-full shadow transition-transform duration-300 peer-checked:translate-x-5"></span>
                </div>
            </td>
            <td class="px-6 py-4 text-center">
                <button class="text-blue-500 hover:text-blue-700 transition-colors duration-200" data-id="${groupData.groupId}" class="editBtn">
                    âœï¸ ìˆ˜ì •
                </button>
            </td>
            <td class="px-6 py-4 text-center">
                <button class="text-red-500 hover:text-red-700 active:scale-95 transition-transform duration-200" data-id="${groupData.groupId}" class="deleteBtn">
                    ğŸ—‘ï¸ ì‚­ì œ
                </button>
            </td>
        `;
            tableBody.appendChild(row);

        } catch (e) {
            console.error("ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e);
        }
    };


    //     // ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ ì²˜ë¦¬
    //     document.querySelectorAll('.editBtn').forEach(button => {
    //         button.addEventListener('click', function() {
    //             const groupId = this.dataset.id;
    //             editGroup(groupId);
    //         });
    //     });
    //
    //     // ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œ ì²˜ë¦¬
    //     document.querySelectorAll('.deleteBtn').forEach(button => {
    //         button.addEventListener('click', function() {
    //             const groupId = this.dataset.id;
    //             deleteGroup(groupId);
    //         });
    //     });
    // };

    // ê·¸ë£¹ ìˆ˜ì • ìš”ì²­
    // function editGroup(groupId) {
    //     const groupName = prompt("ê·¸ë£¹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:");
    //
    //     if (groupName) {
    //         // ì„œë²„ë¡œ ê·¸ë£¹ ìˆ˜ì • ì „ì†¡
    //         fetch(`${BASEURL}/api/sse/groups/${groupId}`, {
    //             method: 'PUT',
    //             headers: {
    //                 'Content-Type': 'application/json'
    //             },
    //             body: JSON.stringify({ name: groupName })
    //         })
    //             .then(response => response.json())
    //             .then(data => {
    //                 console.log("ìˆ˜ì • ì„±ê³µ:", data);
    //             })
    //             .catch(error => {
    //                 console.error("ìˆ˜ì • ì‹¤íŒ¨:", error);
    //             });
    //     }
    // }

    // // ê·¸ë£¹ ì‚­ì œ ìš”ì²­
    // function deleteGroup(groupId) {
    //     if (confirm("ì •ë§ë¡œ ì´ ê·¸ë£¹ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
    //         fetch(`${BASEURL}/api/sse/groups/${groupId}`, {
    //             method: 'DELETE'
    //         })
    //             .then(response => response.json())
    //             .then(data => {
    //                 console.log("ì‚­ì œ ì„±ê³µ:", data);
    //             })
    //             .catch(error => {
    //                 console.error("ì‚­ì œ ì‹¤íŒ¨:", error);
    //             });
    //     }
    // }
    //
    // // SSE ì—°ê²° ì¢…ë£Œ ì‹œ ì²˜ë¦¬
    // eventSource.onerror = function(error) {
    //     console.error("SSE ì—°ê²° ì˜¤ë¥˜:", error);
    //
    //     eventSource.close();  // ì˜¤ë¥˜ ë°œìƒ ì‹œ ì—°ê²° ì¢…ë£Œ
    // };
    //
    // // ê·¸ë£¹ ì¶”ê°€ ë²„íŠ¼ ì´ë²¤íŠ¸ (ì¶”ê°€ì ìœ¼ë¡œ ê·¸ë£¹ ì¶”ê°€ ê¸°ëŠ¥)
    // document.getElementById("addGroupBtn").addEventListener("click", function() {
    //     const groupName = prompt("ìƒˆ ê·¸ë£¹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:");
    //     if (groupName) {
    //         fetch(`${BASEURL}/api/sse/groups`, {
    //             method: 'POST',
    //             headers: {
    //                 'Content-Type': 'application/json'
    //             },
    //             body: JSON.stringify(
    //                 {
    //                     groupId : null,
    //                     groupName: groupName,
    //                     isRead : true,
    //                     isWrite : true
    //                 }
    //             )
    //         })
    //             .then(response => response.json())
    //             .then(data => {
    //                 console.log("ê·¸ë£¹ ì¶”ê°€ ì„±ê³µ:", data);
    //             })
    //             .catch(error => {
    //                 console.error("ê·¸ë£¹ ì¶”ê°€ ì‹¤íŒ¨:", error);
    //             });
    //     }
    // });

</script>

</body>
</html>
